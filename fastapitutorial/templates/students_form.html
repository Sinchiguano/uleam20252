<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Students UI (SQLite)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 2rem auto; max-width: 820px; }
    h1 { margin-bottom: .5rem; }
    form, .card { border: 1px solid #ddd; border-radius: 10px; padding: 1rem; margin: 1rem 0; }
    label { display: block; margin: .5rem 0 .25rem; font-weight: 600; }
    input { width: 100%; padding: .6rem; border: 1px solid #ccc; border-radius: 8px; }
    button { padding: .6rem 1rem; border: 0; border-radius: 8px; cursor: pointer; }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-danger { background: #b91c1c; color: #fff; }
    .row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
    .row-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: .5rem; }
    th, td { border-bottom: 1px solid #eee; padding: .6rem; text-align: left; }
    #msg { margin: .5rem 0; }
    .ok { color: #065f46; }
    .err { color: #7f1d1d; }
    .controls { display: flex; gap: .5rem; align-items: center; flex-wrap: wrap; }
    small.mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; color: #555; }
  </style>
</head>
<body>
  <h1>Students (SQLite)</h1>
  <p class="card">A minimal HTML page that talks to your FastAPI endpoints at
    <span class="mono"><code>/students-db</code></span>. Use it to create and list students.</p>

  <form id="createForm" class="card">
    <h2>Create Student</h2>
    <div id="msg"></div>
    <div class="row">
      <div>
        <label for="first_name">First name</label>
        <input id="first_name" name="first_name" required maxlength="50" />
      </div>
      <div>
        <label for="last_name">Last name</label>
        <input id="last_name" name="last_name" required maxlength="50" />
      </div>
    </div>
    <div class="row">
      <div>
        <label for="email">Email</label>
        <input id="email" name="email" type="email" required />
      </div>
      <div>
        <label for="age">Age</label>
        <input id="age" name="age" type="number" min="0" max="120" required />
      </div>
    </div>
    <p>
      <button type="submit" class="btn-primary">Create</button>
      <small class="mono">POST /students-db/</small>
    </p>
  </form>

  <div class="card">
    <h2>Students List</h2>
    <div class="controls">
      <input id="q" placeholder="Search by name or emailâ€¦" />
      <button id="btnSearch" class="btn-primary">Search</button>
      <button id="btnReset">Reset</button>
      <small class="mono">GET /students-db?q=&skip=&limit=</small>
    </div>
    <div class="controls">
      <label>Skip <input id="skip" type="number" value="0" min="0" style="width:6rem" /></label>
      <label>Limit <input id="limit" type="number" value="20" min="1" style="width:6rem" /></label>
      <button id="btnReload">Reload</button>
    </div>
    <table id="tbl">
      <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Age</th><th></th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const msg = (t, ok=false) => { const m = $('#msg'); m.textContent = t; m.className = ok ? 'ok' : 'err'; };

    async function createStudent(e) {
      e.preventDefault();
      const payload = {
        first_name: $('#first_name').value.trim(),
        last_name:  $('#last_name').value.trim(),
        email:      $('#email').value.trim(),
        age:        Number($('#age').value)
      };
      try {
        const r = await fetch('/students-db/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!r.ok) {
          const err = await r.json().catch(()=>({detail:r.statusText}));
          throw new Error(err.detail || 'Error creating student');
        }
        msg('Created successfully.', true);
        e.target.reset();
        loadStudents();
      } catch (err) {
        msg(err.message || 'Failed.');
      }
    }

    async function loadStudents() {
      const q = $('#q').value.trim();
      const skip = Number($('#skip').value) || 0;
      const limit = Number($('#limit').value) || 20;
      const params = new URLSearchParams({ skip, limit });
      if (q) params.append('q', q);

      const r = await fetch('/students-db/?' + params.toString());
      const data = await r.json();
      const tbody = $('#tbl tbody');
      tbody.innerHTML = '';
      (data || []).forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.id}</td>
          <td>${s.first_name} ${s.last_name}</td>
          <td>${s.email}</td>
          <td>${s.age}</td>
          <td><button class="btn-danger" data-id="${s.id}">Delete</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('button[data-id]').forEach(btn => {
        btn.addEventListener('click', () => delStudent(btn.dataset.id));
      });
    }

    async function delStudent(id) {
      if (!confirm('Delete student #' + id + '?')) return;
      const r = await fetch('/students-db/' + id, { method: 'DELETE' });
      if (r.status === 204) {
        msg('Deleted #' + id, true);
        loadStudents();
      } else {
        const err = await r.json().catch(()=>({detail:r.statusText}));
        msg(err.detail || 'Delete failed');
      }
    }

    // Wire up events
    $('#createForm').addEventListener('submit', createStudent);
    $('#btnReload').addEventListener('click', loadStudents);
    $('#btnSearch').addEventListener('click', (e)=>{ e.preventDefault(); loadStudents(); });
    $('#btnReset').addEventListener('click', (e)=>{ e.preventDefault(); $('#q').value=''; $('#skip').value=0; $('#limit').value=20; loadStudents(); });

    // Initial load
    loadStudents();
  </script>
</body>
</html>
